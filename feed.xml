<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.0">Jekyll</generator><link href="https://www.lnki.me/feed.xml" rel="self" type="application/atom+xml" /><link href="https://www.lnki.me/" rel="alternate" type="text/html" /><updated>2021-02-20T20:17:29+08:00</updated><id>https://www.lnki.me/feed.xml</id><title type="html">Lnki’s Home · 网上冲浪日志</title><subtitle>这里是 Lnki 的小站，我在这里分享知识、记录日常。</subtitle><author><name>Lnki</name></author><entry><title type="html">常见协议之 ARP 与 DHCP</title><link href="https://www.lnki.me/2018/09/arp-dhcp/" rel="alternate" type="text/html" title="常见协议之 ARP 与 DHCP" /><published>2018-09-30T00:00:00+08:00</published><updated>2018-09-30T00:00:00+08:00</updated><id>https://www.lnki.me/2018/09/arp-dhcp</id><content type="html" xml:base="https://www.lnki.me/2018/09/arp-dhcp/">&lt;h2 id=&quot;一arp&quot;&gt;一、ARP&lt;/h2&gt;

&lt;p&gt;ARP 即地址解析协议，用于将 IP 地址解析为 MAC 地址，来建立逻辑地址到物理地址的映射。&lt;/p&gt;

&lt;p&gt;发送方将 IP 报文封装为帧时，需要知道接收方的 MAC 地址。如下图所示，发送方先查找本地 ARP 缓存是否存在目的 IP 地址或下一跳的 MAC 地址记录，若没有记录，就会广播 ARP Request 报文，询问接收方的 MAC 地址，接收方具有目的 IP 地址，将会以单播的形式响应，告知自己的 MAC 地址，同时记录发送方的 IP 地址和 MAC 地址。&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/arp.webp&quot; alt=&quot;ARP 地址解析过程示意图&quot; /&gt;
  &lt;figcaption&gt;
      ARP 地址解析过程

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;p&gt;除了解析地址，ARP 还用于探测局域网中IP地址是否存在。对于 IPv4 网络，kernel 会定时向指定 IP 发送单播的 ARP Request 报文，通常是 1 分钟发送 3 个，若所有请求都没有收到 ARP Response 报文，内核判定探测的 IP 地址在网络中已不可达，通过 netlink 向用户空间报告 IP 地址不可达的事件。&lt;/p&gt;

&lt;h2 id=&quot;二dhcp&quot;&gt;二、DHCP&lt;/h2&gt;

&lt;p&gt;IPv4 网络常使用 DHCP 进行 IP 地址分配，DHCP 交换过程分为四步，就像下图这样：&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/dhcp.webp&quot; alt=&quot;DHCP 地址申请过程图&quot; /&gt;
  &lt;figcaption&gt;
      DHCP 地址申请过程

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;ol&gt;
  &lt;li&gt;客户端请求 IP 地址时，在局域网中广播一个 DHCPDISCOVER 报文，源地址为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0.0.0.0&lt;/code&gt;，目的地址为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;255.255.255.255&lt;/code&gt;，即 IP 广播地址；&lt;/li&gt;
  &lt;li&gt;DHCP 服务器收到后以广播的方式回复 DHCPOFFER 报文，包含服务器 IP 地址、地址池中可以分配的 IP 地址，以及其他 DHCP 配置信息；&lt;/li&gt;
  &lt;li&gt;网络中可能存在多个 DHCP 服务器，客户端收到第一个 DHCPOFFER 报文后便不再接受其他 DHCPOFFER 报文，广播 DHCPREQUEST 报文，向指定的 DHCP 服务器请求 IP 地址；&lt;/li&gt;
  &lt;li&gt;DHCP 服务器返回 DHCPACK 报文，确认 IP 地址分配，依然是广播的方式，若收到 DHCPREQUEST 报文时被申请的 IP 已被分配，则发送 DHCPDECLINE 报文告知 IP 已不可用。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;客户端收到后 DHCPACK 后，IP 地址配置完成，可以进行 IP 通信。客户端可以随时发送 DHCPRELEASE 报文释放 IP 地址，服务端收到后回收 IP 地址。如果客户端请求的 IP 地址不可用，DHCP 服务器会响应 DHCPNAK，客户端会重新开始 DHCP 交换流程。&lt;/p&gt;

&lt;p&gt;通过 DHCP 分配的 IP 地址是有租期的，客户端需要定期发起续租，续租过程分为 renew 和 rebind 两个阶段，客户端维护两个计时器 T1 和 T2，分别对应 renew 和 rebind，计时结束时启动相应阶段的续租流程。下面是 DHCP 续租流程：&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/dhcp-renew-rebind.webp&quot; alt=&quot;DHCP 刷新时序图&quot; /&gt;
  &lt;figcaption&gt;
      &lt;a href=&quot;http://www.tcpipguide.com/free/t_DHCPLeaseRenewalandRebindingProcesses-2.htm&quot;&gt;DHCP 刷新过程&lt;/a&gt;

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;T1 结束时，客户端向与 IP 地址配置绑定的 DHCP 服务器单播 DHCPREQUEST 报文，请求获取相同的配置，若该 DHCP 服务器响应 DHCPACK 报文，则续租完成，T1 和 T2 重新计时，否则重新发送 DHCPREQUEST 报文，直到 T2 结束。&lt;/li&gt;
  &lt;li&gt;T2 结束，意味着指定的 DHCP 服务器不可访问，此时客户端广播 DHCPREQUEST 报文，网络中的其他 DHCP 服务器响应 DHCPACK，续租完成，T1、T2 重新计时，否则重复广播 DHCPREQUEST 报文，直至租期结束。&lt;/li&gt;
  &lt;li&gt;如果租期结束，或者客户端收到了 DHCPNAK 报文，则续租失败，客户端发起新的 DHCP 地址申请流程。&lt;/li&gt;
&lt;/ul&gt;</content><author><name>Lnki</name></author><category term="技术" /><category term="网络" /><summary type="html">一、ARP</summary></entry><entry><title type="html">IEEE 802.11 MAC 帧</title><link href="https://www.lnki.me/2018/09/wlan-frame/" rel="alternate" type="text/html" title="IEEE 802.11 MAC 帧" /><published>2018-09-13T00:00:00+08:00</published><updated>2018-09-13T00:00:00+08:00</updated><id>https://www.lnki.me/2018/09/wlan-frame</id><content type="html" xml:base="https://www.lnki.me/2018/09/wlan-frame/">&lt;p&gt;Ehternet 的成帧很简单，只需在前加上前导码、寻址信息并在结尾加上校验和，相比而言，802.11 的成帧复杂，因为无线网络需要加入较多控制和管理的功能。&lt;/p&gt;

&lt;h2 id=&quot;一帧格式&quot;&gt;一、帧格式&lt;sup id=&quot;fnref:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/h2&gt;

&lt;p&gt;下图为一般的 802.11 MAC 帧格式，单位为字节，会用到哪些字段取决于帧的类型。&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/80211-general-frame.webp&quot; alt=&quot;一般的 802.11 帧格式示意图&quot; /&gt;
  &lt;figcaption&gt;
      一般的 802.11 MAC 帧格式

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;dl&gt;
  &lt;dt&gt;Frame Control&lt;/dt&gt;
  &lt;dd&gt;帧控制字段，包含协议、帧类型以及标志位等信息。其中 Type 字段标记当前帧的类型，包括管理帧、控制帧、数据帧三类；Sub-type 字段标记每种帧类型中的子类型，不同类型的帧有不同的处理方式。&lt;/dd&gt;
&lt;/dl&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/80211-frame-frame-control.webp&quot; alt=&quot;Frame Control 字段示意图&quot; /&gt;
  &lt;figcaption&gt;
      Frame Control 字段

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;dl&gt;
  &lt;dt&gt;Duration / ID&lt;/dt&gt;
  &lt;dd&gt;这个字段有三种形式，如下图。设定 NAV 时，第 15 位为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt;，其他位标识 NAV 的值，单位为微秒；在无竞争周期传送的帧中，第 14、15 位为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;01&lt;/code&gt;，其余位均为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt;，用来公告所有 STA 网络无竞争周期，避免它们干扰传送；在 PS-Poll（省电轮询）帧中，第 14、15 位为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;11&lt;/code&gt;，其他位则表示 AID（Association ID），AP 用来查找相应的缓冲帧。&lt;/dd&gt;
&lt;/dl&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/80211-frame-nav-id.webp&quot; alt=&quot;Duration / ID 字段示意图&quot; /&gt;
  &lt;figcaption&gt;
      Duration / ID 字段的表示形式

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;dl&gt;
  &lt;dt&gt;Address&lt;/dt&gt;
  &lt;dd&gt;802.11 帧最多包含 4 个地址字段，不同类型的帧包含的地址字段数量有所不同，它们可能表示目的地址（最终的接收端）、来源地址（帧的来源）、接收端地址（负责接收处理该帧的无线设备，可以是 STA 或 AP）、发送端地址（将帧传至无线媒介的无线接口）或者 BSSID（在基础结构型网络里是 AP 的 MAC 地址，在独立型网络则为随机的值）。&lt;/dd&gt;
  &lt;dt&gt;Sequence Control&lt;/dt&gt;
  &lt;dd&gt;分为片段编号和顺序编号，用于重组片段和丢弃重复帧。&lt;/dd&gt;
&lt;/dl&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/80211-frame-seq-ctrl.webp&quot; alt=&quot;Sequence Control 字段示意图&quot; /&gt;
  &lt;figcaption&gt;
      Sequence Control 字段

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;dl&gt;
  &lt;dt&gt;Frame Body&lt;/dt&gt;
  &lt;dd&gt;帧主体，负责传递上层有效载荷（Payload）。&lt;/dd&gt;
  &lt;dt&gt;FCS（Frame Check Sequence）&lt;/dt&gt;
  &lt;dd&gt;帧校验序列，是一种 32 bit 长的循环冗余校验码（CRC），FCS 和 CRC 的底层算法相同，用于检查所收到的帧的完整性。&lt;/dd&gt;
&lt;/dl&gt;

&lt;h2 id=&quot;二对上层协议的封装&quot;&gt;二、对上层协议的封装&lt;/h2&gt;

&lt;p&gt;和以太网不同，802.11 封装依靠 802.2 的逻辑链路层封装来携带上层数据包。封装三层数据包时，先由衍生自 802.2 子网访问协议（SNAP，Sub-network Access Protocol）的 RFC 1042 或 802.1h 封装，SNAP 标头以目的服务接入点（DSAP，Destination Service Access Point）和源服务接入点（SSAP，Source Service Access Point）开始，之后依次为控制、OUI（组织唯一标识）、数据包类型字段，最后是数据包主体。LLC 层封装后，802.11 会再添加 MAC 标头，填入目的地址、源地址等信息，最后计算数据帧的帧校验序列，加到帧的末尾。&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/80211-frame-ip-encap.webp&quot; alt=&quot;IEEE 802.11 封装 IP 示意图&quot; /&gt;
  &lt;figcaption&gt;
      IEEE 802.11 对 IP 的封装

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;h2 id=&quot;三帧类型&quot;&gt;三、帧类型&lt;sup id=&quot;fnref:1:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/h2&gt;

&lt;p&gt;前面有提到，802.11 MAC 帧分为三类，分别为数据帧、控制帧和管理帧，本节介绍各种帧的特点及作用。&lt;/p&gt;

&lt;h3 id=&quot;1-数据帧&quot;&gt;1. 数据帧&lt;/h3&gt;

&lt;p&gt;数据帧主要负责承载数据的传输，将上层协议的数据置于帧主体中加以传递，此外它还标记数据的传输方式，例如 QoS、CF-Poll 等等。控制帧和管理帧不承载上层数据包。数据帧子类型包括下面这些：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Data&lt;/li&gt;
  &lt;li&gt;Data + CF-ACK&lt;/li&gt;
  &lt;li&gt;Data + CF-Poll&lt;/li&gt;
  &lt;li&gt;Data + CF-ACK + CF-Poll&lt;/li&gt;
  &lt;li&gt;Null（无承载数据）&lt;/li&gt;
  &lt;li&gt;CF-ACK（无承载数据）&lt;/li&gt;
  &lt;li&gt;CF-Poll（无承载数据）&lt;/li&gt;
  &lt;li&gt;CF-ACK + CF-Poll（无承载数据）&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;另外，802.11e 提议引入 QoS，但尚未标准化，Sub-type 字段首位为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt; 则表示启用了 QoS 支持，因此，有人称第一位为 QoS 位。&lt;/p&gt;

&lt;h3 id=&quot;2-控制帧&quot;&gt;2. 控制帧&lt;/h3&gt;

&lt;p&gt;控制帧负责管理媒介的访问权，避免物理链路发生冲突，并且确保帧被成功传输，提供 MAC 层的可靠性，此外还包括省电程序；&lt;/p&gt;

&lt;dl&gt;
  &lt;dt&gt;RTS 帧&lt;/dt&gt;
  &lt;dd&gt;用来预约无线链路的使用权，为了确保传输数据时不会有冲突，会先发送一个 RTS 帧，其他设备收到 RTS 帧后，会在一段时间内保持静默。&lt;/dd&gt;
  &lt;dt&gt;CTS 帧&lt;/dt&gt;
  &lt;dd&gt;用于应答 RTS 帧，接收端收到 RTS 帧后，如果没有冲突，便应答一个 CTS 帧，标识当前无线链路可用，CTS 帧同样会使其他设备保持静默，如果发送端发送 RTS 后没有收到 CTS，便判定物理链路忙碌，将在一段时间内保持静默。&lt;/dd&gt;
  &lt;dt&gt;ACK 帧&lt;/dt&gt;
  &lt;dd&gt;确认数据已正确传输，接收端正确接数据后，应答一个 ACK 帧，若发送端未收到 ACK，则认为传输失败，将重传数据，以此实现传输的可靠性。&lt;/dd&gt;
&lt;/dl&gt;

&lt;p&gt;这里提一下，802.11 网络中的物理链路访问控制和传输可靠性主要依靠的就是 RTS、CTS、ACK。&lt;/p&gt;

&lt;p&gt;在传输大型帧时干扰较多，需要用 RTS 来取得媒介的访问权。网卡驱动会设置一个 RTS 阈值，传送大于 RTS 阈值的帧之前，先进行 RTS / CTS 交换，先向接收端发送 RTS 帧，接收端收到 RTS 后应答 CTS 帧，以此清空物理链路，然后发送端再发送数据帧，接收端正确接收后，应答ACK；至于长度小于 RTS 阈值的帧，则不进行 RTS / CTS 交换，直接发送数据帧，然后接收端应答 ACK。上述流程中，每个帧之间都间隔 SIFS，流程结束后进入 DIFS，DIFS 结束后网络中的设备再次开始竞争物理链路使用权。&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/80211-rtc-cts-ack.webp&quot; alt=&quot;RTS / CTS 清空物理链路示意图&quot; /&gt;
  &lt;figcaption&gt;
      传输长度大于 RTS 阈值的帧

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;dl&gt;
  &lt;dt&gt;PS-Poll 帧&lt;/dt&gt;
  &lt;dd&gt;控制帧的子类型中还包括 PS-Poll 帧，参与 802.11 的省电程序机制，用于从 AP 获取缓存帧。PS-Poll 帧中包含一个 AID 字段，AID（Association ID）即关联 ID，用于识别关联，便于 AP 为该关联找出缓存的帧。&lt;/dd&gt;
  &lt;dt&gt;CF-End 帧&lt;/dt&gt;
  &lt;dd&gt;表示无竞争周期结束。&lt;/dd&gt;
  &lt;dt&gt;CF-End + CF-ACK 帧&lt;/dt&gt;
  &lt;dd&gt;表示无竞争周期结束，同时进行无竞争周期确认。&lt;/dd&gt;
&lt;/dl&gt;

&lt;h3 id=&quot;3-管理帧&quot;&gt;3. 管理帧&lt;/h3&gt;

&lt;p&gt;管理帧主要负责网络的访问控制，参与 WLAN 的连接、断开、身份验证等操作，以及进行 WLAN 的识别，使无线网络能实现类似传统有线网络的寻找插座、连接网线等操作。与控制帧相比，控制帧管理的是数据传输的过程，而管理帧管理的是无线网络本身。管理帧包含帧主体，可以携带一些固定字段或是信息元素，以传递详细的网络管理消息，例如 SSID、WPA 密钥等等。&lt;/p&gt;

&lt;dl&gt;
  &lt;dt&gt;Beacon 帧&lt;/dt&gt;
  &lt;dd&gt;一种比较重要的类型，用于声明网络的存在，是网络的信标，其中包含 SSID、BSSID 等字段，以及加入网络所需的参数，周期性传送信标可以让 STA 得知网络的存在。&lt;/dd&gt;
  &lt;dt&gt;Probe Request 帧&lt;/dt&gt;
  &lt;dd&gt;探查请求，用来扫描区域内的 802.11 网络，它包含要探查的 SSID 和 STA 支持的频率信息，收到 Probe Request 帧的 AP 会判断 STA 是否能加入网络。&lt;/dd&gt;
  &lt;dt&gt;Probe Response 帧&lt;/dt&gt;
  &lt;dd&gt;即探查响应，收到 Probe Request 帧后，若 STA 与网络兼容，AP 就会应答一个 Probe Response 帧。Probe Response 包含 Beacon 中的所有参数，STA 根据它调整加入网络所需的参数。&lt;/dd&gt;
  &lt;dt&gt;ATIM 帧&lt;/dt&gt;
  &lt;dd&gt;Announcement Traffic Indication Message 即通知传输指示消息，用于 IBSS 的省电机制，某台设备休眠时，会发出一个 ATIM 帧，此后发往该设备的帧会被发送方缓存。&lt;/dd&gt;
  &lt;dt&gt;Authentication 帧&lt;/dt&gt;
  &lt;dd&gt;用于建立连接前的身份验证，帧中包含算法代号，由于使用的算法不同，认证过程可能包含多个步骤，因此要为每个 Authentication 帧标记序号，状态码和质询文本因算法而异。&lt;/dd&gt;
  &lt;dt&gt;Association Request 帧&lt;/dt&gt;
  &lt;dd&gt;用来请求加入网络，STA 判断与网络兼容并通过身份验证后，便会发送 Association Request 帧 请求关联。&lt;/dd&gt;
  &lt;dt&gt;Association Response 帧与Reassociation Response 帧&lt;/dt&gt;
  &lt;dd&gt;分别用于关联请求和重新关联请求的响应，在响应过程中，会为当前关联指定 AID，(Re)Association Response 帧传输完成后关联关系建立。&lt;/dd&gt;
  &lt;dt&gt;Reassociation Request 帧&lt;/dt&gt;
  &lt;dd&gt;主要用于同一 ESS 内的 BSS 切换过程，允许 STA 短暂离开网络后重新加入，相较于 Association Request 帧，Reassociation Request 帧包含 STA 此前关联的 AP 的 MAC 地址，这样新旧 AP 可以彼此联系和转移缓存的数据。&lt;/dd&gt;
  &lt;dt&gt;Disassociation 帧与 Deauthentication 帧&lt;/dt&gt;
  &lt;dd&gt;分别用于解除关联关系和认证关系，两者均包含一个 Reason 字段，用于描述解除关系的原因。在解除认证关系时会自动解除关联关系。&lt;/dd&gt;
  &lt;dt&gt;Action 帧&lt;/dt&gt;
  &lt;dd&gt;由 802.11h 引入，用于其他功能，例如 DFS。&lt;/dd&gt;
&lt;/dl&gt;

&lt;h2 id=&quot;四帧的内容&quot;&gt;四、帧的内容&lt;/h2&gt;

&lt;p&gt;到这里，我们已经了解到，802.11 MAC 设计了多种类型的帧来保证 WLAN 正常工作，为了理解成帧细节，下面就以 Beacon 帧为例，抓包看看 802.11 MAC 帧的内容。&lt;/p&gt;

&lt;p&gt;首先 Beacon 帧的 MAC 标头长度为 24 字节。&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/80211-beacon-header.webp&quot; alt=&quot;Beacon 帧 MAC 标头图&quot; /&gt;
  &lt;figcaption&gt;
      Beacon 帧中的 MAC 标头

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;dl&gt;
  &lt;dt&gt;Frame Control（2 字节）&lt;/dt&gt;
  &lt;dd&gt;其中协议版本（2 bit）为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt;，帧类型（2 bit）为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;00&lt;/code&gt;（管理帧），子类型（4 bit）为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;000&lt;/code&gt;（Beacon 帧），标志位（8 bit）全部置 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt;。&lt;/dd&gt;
&lt;/dl&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/80211-beacon-frame-ctrl.webp&quot; alt=&quot;Beacon 帧 Frame Control 字段内容图&quot; /&gt;
  &lt;figcaption&gt;
      Frame Control 字段内容

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;dl&gt;
  &lt;dt&gt;Duration 字段（2 字节）&lt;/dt&gt;
  &lt;dd&gt;值为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt;，表示 NAV 为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt;，不进行计时。&lt;/dd&gt;
&lt;/dl&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/80211-beacon-duration.webp&quot; alt=&quot;Beacon 帧 Duration 字段内容图&quot; /&gt;
  &lt;figcaption&gt;
      Duration 字段内容

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;dl&gt;
  &lt;dt&gt;目的地址（6 字节）&lt;/dt&gt;
  &lt;dd&gt;值为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ff:ff:ff:ff:ff:ff&lt;/code&gt;，广播地址，Beacon 帧的定义中没有接收端地址。&lt;/dd&gt;
&lt;/dl&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/80211-beacon-da.webp&quot; alt=&quot;Beacon 帧目的地址图&quot; /&gt;
  &lt;figcaption&gt;
      目的地址

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;dl&gt;
  &lt;dt&gt;源地址（6 字节）&lt;/dt&gt;
  &lt;dd&gt;值为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;96:63:72:0e:9f:e1&lt;/code&gt;，同样地，Beacon 帧的定义中没有发送端地址。&lt;/dd&gt;
&lt;/dl&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/80211-beacon-sa.webp&quot; alt=&quot;Beacon 帧源地址图&quot; /&gt;
  &lt;figcaption&gt;
      源地址

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;dl&gt;
  &lt;dt&gt;BSSID（6 字节）&lt;/dt&gt;
  &lt;dd&gt;值为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;96:63:72:0e:9f:e1&lt;/code&gt;，与源地址相同，以 AP 的 MAC 地址作为 BSSID。&lt;/dd&gt;
&lt;/dl&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/80211-beacon-bssid.webp&quot; alt=&quot;Beacon 帧 BSSID 字段内容图&quot; /&gt;
  &lt;figcaption&gt;
      BSSID 字段内容

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;dl&gt;
  &lt;dt&gt;帧分片序号（4 bit）&lt;/dt&gt;
  &lt;dd&gt;值为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt;，表示不分片；帧序列号（12 bit）为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;694&lt;/code&gt;。&lt;/dd&gt;
&lt;/dl&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/80211-beacon-fragment-seq.webp&quot; alt=&quot;Beacon 帧分片序号与序列号字段内容图&quot; /&gt;
  &lt;figcaption&gt;
      分片序号与序列号

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;dl&gt;
  &lt;dt&gt;帧校验序列（4 bit）&lt;/dt&gt;
  &lt;dd&gt;在帧主体后面，帧的结尾处，值为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0xEA820968&lt;/code&gt;，显示校验结果正确，数据完整。&lt;/dd&gt;
&lt;/dl&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/80211-beacon-fcs.webp&quot; alt=&quot;Beacon 帧校验序列内容图&quot; /&gt;
  &lt;figcaption&gt;
      帧校验序列字段内容

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;dl&gt;
  &lt;dt&gt;Beacon 帧主体&lt;/dt&gt;
  &lt;dd&gt;分为固定长度的固定字段（Fixed Parameters）和长度不定的标签字段（Tagged Parameters）。&lt;/dd&gt;
&lt;/dl&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/80211-beacon-body.webp&quot; alt=&quot;Beacon 帧主体内容图&quot; /&gt;
  &lt;figcaption&gt;
      Beacon 帧主体

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;dl&gt;
  &lt;dt&gt;信息元素：SSID&lt;/dt&gt;
  &lt;dd&gt;最后看看 Beacon 帧主体中的标签字段 SSID，每个标签字段也称为信息元素（Information Element，EI），是长度不定的字符串，SSID 长度介于 0 至 32 字节之间，元素编号（1 字节）为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt;，长度（1 字节）为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;10&lt;/code&gt;，无线网络的 SSID 为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vivo NEX S&lt;/code&gt;。&lt;/dd&gt;
&lt;/dl&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/80211-beacon-tag-ssid.webp&quot; alt=&quot;Beacon 帧 SSID 标签内容图&quot; /&gt;
  &lt;figcaption&gt;
      SSID 标签

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;h2 id=&quot;五总结&quot;&gt;五、总结&lt;/h2&gt;

&lt;p&gt;分析完 802.11 MAC 帧的部分细节，对 802.11 工作原理有了一个系统化的、动态的认识，了解了一些典型机制的基本原理，比如可靠性传输、竞争周期、建立连接、扫描的过程等等，将日常使用 Wi-Fi 的操作和这些帧对应起来，就明白我们通过 Wi-Fi 上网时，设备之间究竟发生了什么。当然，这里也不可能了解 802.11 MAC 帧的全部内容，更多原理有待后续学习。&lt;/p&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Gast, M. S. 802.11® 无线网络权威指南[M]. 第 2 版. O’Reilly Taiwan 公司. 南京 - 东南大学出版社, 2007.12: 57-66,88-105 &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt; &lt;a href=&quot;#fnref:1:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;</content><author><name>Lnki</name></author><category term="技术" /><category term="网络" /><category term="WLAN" /><summary type="html">Ehternet 的成帧很简单，只需在前加上前导码、寻址信息并在结尾加上校验和，相比而言，802.11 的成帧复杂，因为无线网络需要加入较多控制和管理的功能。</summary></entry><entry><title type="html">IEEE 802.11 MAC 基础盘点</title><link href="https://www.lnki.me/2018/09/wlan-mac/" rel="alternate" type="text/html" title="IEEE 802.11 MAC 基础盘点" /><published>2018-09-12T00:00:00+08:00</published><updated>2018-09-12T00:00:00+08:00</updated><id>https://www.lnki.me/2018/09/wlan-mac</id><content type="html" xml:base="https://www.lnki.me/2018/09/wlan-mac/">&lt;p&gt;这里简单过一过 IEEE 802.11 MAC 层的常见概念&lt;sup id=&quot;fnref:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;，了解这些名词基本的的用途和目的，具体原理就不做深入讨论了。&lt;/p&gt;

&lt;dl&gt;
  &lt;dt&gt;MAC（Media Access Control）&lt;/dt&gt;
  &lt;dd&gt;OSI 模型数据链路层子层，直接管理传输媒介，将传输媒介抽象为物理链路，负责物理链路冲突的避免、进行帧的封装与解封、错误检测和主机定位。&lt;/dd&gt;
  &lt;dt&gt;主动确认（Positive ACK）&lt;/dt&gt;
  &lt;dd&gt;由于无线链路的特殊性，传输会受到噪声和干扰的影响，802.11 采用主动确认的机制，所有传出去的帧必须得到回应，否则认为传输漏失，会进行重传。&lt;/dd&gt;
  &lt;dt&gt;隐藏节点问题&lt;/dt&gt;
  &lt;dd&gt;假设下图中节点 2 可以直接和节点 1、3 直接通信，但由于某些原因节点 1 无法直接接收到节点 3 的信号，对于节点 1 而言，节点 3 就是隐藏节点。节点 1、3 可能同时向节点 2 发送数据，节点 2 同时收到来自两边的数据便会出现异常，而且节点 1、3 也无从得知发生了错误。&lt;/dd&gt;
&lt;/dl&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/80211-mac-hidden-node.webp&quot; alt=&quot;隐藏节点问题示意图&quot; /&gt;
  &lt;figcaption&gt;
      隐藏节点

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;dl&gt;
  &lt;dt&gt;RTS（Request to Send）&lt;/dt&gt;
  &lt;dd&gt;为了解决隐藏节点问题，防止冲突发生，802.11 引入 RTS / CTS 机制，发送端在发送数据前，会先发送一个 RTS 帧，预约无线链路的使用权，其他 STA 收到 RTS 帧后，会在一段时间内保持静默。&lt;/dd&gt;
  &lt;dt&gt;CTS（Clear to Send）&lt;/dt&gt;
  &lt;dd&gt;接收端收到 RTS 帧后，便应答一个 CTS 帧，标识当前无线链路可用，同时 CTS 帧会使其他 STA 保持静默。&lt;/dd&gt;
  &lt;dt&gt;RTS 阈值&lt;/dt&gt;
  &lt;dd&gt;RTS / CTS 交换过程会消耗一定的带宽，在规模不大、接入 STA 较少的无线网络中，很少出现同时传输的情况，且有不少闲置带宽可供重传。RTS 阈值提供了一个折中的冲突控制方案，若帧长度大于阈值，则需要进行 RTS / CTS 交换，否则直接传送帧。&lt;/dd&gt;
  &lt;dt&gt;DCF（Distributed Coordination Function）&lt;/dt&gt;
  &lt;dd&gt;分布式协调功能，是 CSMA/CA 访问机制的基础。传送数据前，先检测无线链路是否处于清空状态，如果有冲突，STA 会随机为每个帧设定一段退避（Backoff）时间，在这段时间内保持静默。&lt;/dd&gt;
  &lt;dt&gt;PCF（Point Coordination Function）&lt;/dt&gt;
  &lt;dd&gt;点协调功能，提供无竞争服务，由 AP 扮演协调者的角色，统一协调安排各终端对无线链路的访问，使其不必通过竞争即可以使用媒介。&lt;/dd&gt;
  &lt;dt&gt;HCF（Hybrid Coordination Function）&lt;/dt&gt;
  &lt;dd&gt;混合协调功能，介于 DCF 和 PCF 之间，尚未完全标准化。&lt;/dd&gt;
  &lt;dt&gt;CSMA/CD（Carrier Sense Multiple Access with Collision Detection）&lt;/dt&gt;
  &lt;dd&gt;带冲突监测的载波监听多路访问技术，发送数据时，先听后发，边发边听，遇到冲突停发，随机延迟后重发。&lt;/dd&gt;
  &lt;dt&gt;CSMA/CA（CSMA with Collision Avoidance）&lt;/dt&gt;
  &lt;dd&gt;带冲突避免的载波监听多路访问技术，基于 CSMA/CD 改进，监听到空闲并维持一段时间后，才发送数据，接收端正确接收后，延迟应答 ACK，发送端收到 ACK，确定数据正确传输，然后进入空闲状态。&lt;/dd&gt;
  &lt;dt&gt;NAV（Network Access Vector）&lt;/dt&gt;
  &lt;dd&gt;网络访问矢量，用于虚拟载波监听，本质上是一个计时器，RTS 和 CTS 携带有 NAV 时间信息，其他 STA 收到这些帧后会依据 NAV 开始计时，NAV 非零时物理链路被视为忙碌，期间保持静默，直到 NAV 归零后，才会继续传输。&lt;/dd&gt;
  &lt;dt&gt;IFS（Interframe Space）&lt;/dt&gt;
  &lt;dd&gt;帧间间隔，是在传输完一个帧后，物理链路从忙碌状态推出后的一段等待时间，用于协调媒介访问。IFS 有几种，如下图：&lt;/dd&gt;
&lt;/dl&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/80211-mac-ifs.webp&quot; alt=&quot;各种帧间隔关系图&quot; /&gt;
  &lt;figcaption&gt;
      各种 IFS 的关系

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;dl&gt;
  &lt;dt&gt;SIFS（Short IFS）&lt;/dt&gt;
  &lt;dd&gt;短帧间间隔，用于优先级较高的传输，例如 RTS、CTS、ACK 等，这些帧在 SIFS 结束后即可进行传输。&lt;/dd&gt;
  &lt;dt&gt;PIFS（PCF IFS）&lt;/dt&gt;
  &lt;dd&gt;用于 PCF，在无竞争时期，有数据待传的 STA 可以等待 PIFS 结束后再传，其优先级高于任何竞争式传输。&lt;/dd&gt;
  &lt;dt&gt;DIFS（DCF IFS）&lt;/dt&gt;
  &lt;dd&gt;用于 DCF，是竞争式服务中最短的媒介闲置时间，若媒介限制时间长于 DIFS，则 STA 可以立即访问媒介。&lt;/dd&gt;
  &lt;dt&gt;EIFS（Extended IFS）&lt;/dt&gt;
  &lt;dd&gt;长度不固定，只在帧传输出现错误时用到。&lt;/dd&gt;
  &lt;dt&gt;DCF 退避算法&lt;/dt&gt;
  &lt;dd&gt;当帧传输完成并经过 DIFS 后，STA 尝试重新传送堵塞的数据。紧接着 DIFS 的是竞争窗口，也被称为退避窗口，当帧传输失败时，该窗口会扩大，以减缓网络拥塞程度。&lt;/dd&gt;
  &lt;dt&gt;单播确认、广播不确认&lt;/dt&gt;
  &lt;dd&gt;尽管无线电是一种广播介质，但因为加入了单播的 QoS 机制，实际上单播传输质量高于广播。&lt;/dd&gt;
  &lt;dt&gt;帧分段和重组&lt;/dt&gt;
  &lt;dd&gt;由于物理属性的限制，来自上层的大型数据包可能需要分段封装后，才能由无线电媒介传输，并有助于抗干扰，提升通信可靠性。接收端收到分段的帧后，再重新组合为原始帧。&lt;/dd&gt;
  &lt;dt&gt;片段突发期&lt;/dt&gt;
  &lt;dd&gt;这段时期，帧分段会连续传输，每个帧片段以 SIFS 分隔，STA 会一直占有媒介访问权。&lt;/dd&gt;
  &lt;dt&gt;省电程序（Powersaving Sequence）&lt;/dt&gt;
  &lt;dd&gt;为了省电，STA 会定期休眠，期间 AP 为其缓存单播帧，STA 苏醒后使用 PS-Poll 帧从 AP 取得这些缓存帧。&lt;/dd&gt;
&lt;/dl&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Gast, M. S. 802.11® 无线网络权威指南[M]. 第 2 版. O’Reilly Taiwan 公司. 南京 - 东南大学出版社, 2007.12: 43-73 &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;</content><author><name>Lnki</name></author><category term="技术" /><category term="网络" /><category term="WLAN" /><summary type="html">这里简单过一过 IEEE 802.11 MAC 层的常见概念1，了解这些名词基本的的用途和目的，具体原理就不做深入讨论了。 Gast, M. S. 802.11® 无线网络权威指南[M]. 第 2 版. O’Reilly Taiwan 公司. 南京 - 东南大学出版社, 2007.12: 43-73 &amp;#8617;</summary></entry><entry><title type="html">IEEE 802.11 概览</title><link href="https://www.lnki.me/2018/09/wlan-overview/" rel="alternate" type="text/html" title="IEEE 802.11 概览" /><published>2018-09-11T00:00:00+08:00</published><updated>2018-09-11T00:00:00+08:00</updated><id>https://www.lnki.me/2018/09/wlan-overview</id><content type="html" xml:base="https://www.lnki.me/2018/09/wlan-overview/">&lt;p&gt;关于无线网络，我们常提到 WLAN、Wi-Fi、IEEE 802.11 a/b/g/n/ac 等名词，它们似乎都可以指无线网络，这里先了解它们的概念和区别：&lt;/p&gt;

&lt;dl&gt;
  &lt;dt&gt;WLAN&lt;/dt&gt;
  &lt;dd&gt;Wireless LAN，即无线局域网，一种局域网形式，物理介质为无线电波&lt;/dd&gt;
  &lt;dt&gt;IEEE 802.11&lt;/dt&gt;
  &lt;dd&gt;由 IEEE 制定的无线网络标准，a/b/g/n/ac 是该标准的几个迭代版本，IEEE 802.11 是现今 WLAN 的通用标准&lt;/dd&gt;
  &lt;dt&gt;Wi-Fi&lt;/dt&gt;
  &lt;dd&gt;一种基于 IEEE 802.11 标准的技术实现，是现今 WLAN 最常采用的技术，它也是 Wi-Fi 联盟的商用标志，用于产品的 WLAN 技术认证。&lt;/dd&gt;
&lt;/dl&gt;

&lt;h2 id=&quot;一背景&quot;&gt;一、背景&lt;/h2&gt;

&lt;h3 id=&quot;1-技术族谱&quot;&gt;1. 技术族谱&lt;sup id=&quot;fnref:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/h3&gt;

&lt;p&gt;IEEE 802 家族由一系列局域网标准组成，主要对 OSI 参考模型的最下面两层作出规范，涵盖了物理层和数据链路层组件。IEEE 802.11 是无线局域网标准，提供了物理层和 MAC 的规范。IEEE 802.11 与以太网有较深的渊源，被称为“无线以太网”，在配置 IEEE 802.11 网络时，不需要对传统的以太网做很多调整便可以将服务扩展至无线网络中，为网络设备带来了可移动性。&lt;/p&gt;

&lt;p&gt;下图是部分 IEEE 802 家族的成员，可以看到家族成员之间的关系及其在 OSI 模型中的角色定位：&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/ieee802-family.webp&quot; alt=&quot;IEEE 802 家族图&quot; /&gt;
  &lt;figcaption&gt;
      IEEE 802 家族

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;p&gt;IEEE 802.11 涵盖了 OSI 模型的物理层和数据链路层，将物理层进一步细分为 PLCP 和 PMD 两个子层，PLCP（Physical Layer Convergence Procedure）负责将 MAC 映射到传输媒介，PMD（Physical Medium Dependent）负责帧的传送。分层结构如下图：&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/ieee80211-phy-mac.webp&quot; alt=&quot;IEEE 802.11 PHY 组件图&quot; /&gt;
  &lt;figcaption&gt;
      IEEE 802.11 物理层结构

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;p&gt;目前 IEEE 802.11 已被淘汰，由 IEEE 802.11a/b/g/n/ac 等修订标准替代，各修订版本主要是针对物理层做优化。下表是各版本的特性及差异：&lt;/p&gt;

&lt;div class=&quot;table-wrapper&quot;&gt;
  &lt;table&gt;&lt;caption&gt;
        &lt;a href=&quot;https://zh.wikipedia.org/wiki/IEEE_802.11ac&quot;&gt;IEEE 802.11 版本比较&lt;/a&gt;

    &lt;/caption&gt;

  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;标准&lt;/th&gt;
      &lt;th&gt;频段&lt;/th&gt;
      &lt;th&gt;最大带宽&lt;/th&gt;
      &lt;th&gt;调制方式&lt;/th&gt;
      &lt;th&gt;最大传输速率&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;802.11&lt;/td&gt;
      &lt;td&gt;2.4 GHz&lt;/td&gt;
      &lt;td&gt;20 MHz&lt;/td&gt;
      &lt;td&gt;FHSS&lt;br /&gt;DSSS&lt;/td&gt;
      &lt;td&gt;2 Mbps&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;802.11a&lt;/td&gt;
      &lt;td&gt;5 GHz&lt;/td&gt;
      &lt;td&gt;20 MHz&lt;/td&gt;
      &lt;td&gt;OFDM&lt;/td&gt;
      &lt;td&gt;54 Mbps&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;802.11b&lt;/td&gt;
      &lt;td&gt;2.4 GHz&lt;/td&gt;
      &lt;td&gt;20 MHz&lt;/td&gt;
      &lt;td&gt;HR-DSSS&lt;/td&gt;
      &lt;td&gt;11 Mbps&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;802.11g&lt;/td&gt;
      &lt;td&gt;2.4 GHz&lt;/td&gt;
      &lt;td&gt;20 MHz&lt;/td&gt;
      &lt;td&gt;OFDM&lt;/td&gt;
      &lt;td&gt;54 Mbps&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;802.11n&lt;/td&gt;
      &lt;td&gt;2.4 GHz&lt;br /&gt;5 GHz&lt;/td&gt;
      &lt;td&gt;40 MHz&lt;/td&gt;
      &lt;td&gt;MIMO-OFDM&lt;/td&gt;
      &lt;td&gt;150 Mbps (40 MHz 1x1)&lt;br /&gt;600 Mbps (40MHz 4x4)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;802.11ac Wave 1&lt;/td&gt;
      &lt;td&gt;5 GHz&lt;/td&gt;
      &lt;td&gt;80 MHz&lt;/td&gt;
      &lt;td&gt;MIMO-OFDM&lt;/td&gt;
      &lt;td&gt;433.3 Mbps (80 MHz 1x1)&lt;br /&gt;1.3 Gbps (80 MHz 3x3)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;802.11ac Wave 2&lt;/td&gt;
      &lt;td&gt;5 GHz&lt;/td&gt;
      &lt;td&gt;160 MHz&lt;/td&gt;
      &lt;td&gt;MIMO-OFDM&lt;/td&gt;
      &lt;td&gt;866.7 Mbps (160 MHz 1x1)&lt;br /&gt;6.9 Gbps (160 MHz 8x8)&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;/div&gt;

&lt;p&gt;IEEE 802.11ac 有两个细分版本，Wave 1 于 2014 年发布，支持 80 MHz 带宽和 3x3 SU-MIMO，Wave 2 于2016 年发布，增加了对 160 MHz 带宽和 8x8 MU-MIMO 的支持，提供更高吞吐量。&lt;/p&gt;

&lt;h3 id=&quot;2-有关组织&quot;&gt;2. 有关组织&lt;/h3&gt;

&lt;h4 id=&quot;ieee-institute-of-electrical-and-electronics-engineers&quot;&gt;IEEE (Institute of Electrical and Electronics Engineers)&lt;/h4&gt;

&lt;p&gt;电气电子工程师协会，是一个非营利性的电子技术和信息工程师的协会，被国际标准化组织授权为可以指定标准的组织，设有众多标准委员会，其中最为著名的是IEEE 802委员会，致力于局域网标准的制定。&lt;/p&gt;

&lt;h4 id=&quot;wi-fi-alliance&quot;&gt;Wi-Fi Alliance&lt;/h4&gt;

&lt;p&gt;Wi-Fi 联盟，是由行业众多公司组建的商业联盟，拥有 Wi-Fi 商标，主要负责建立和执行无线网络标准、优化互操作性与兼容性，并推动无线网络技术，主要业务是无限相容性认证，通过认证的需要符合 IEEE 802.11 无线标准、WPA/WPA2 安全标准、EAP 认证标准。&lt;/p&gt;

&lt;h2 id=&quot;二一些物理层的概念&quot;&gt;二、一些物理层的概念&lt;/h2&gt;

&lt;h3 id=&quot;1-频段和信道&quot;&gt;1. 频段和信道&lt;/h3&gt;

&lt;p&gt;802.11 工作组为 WLAN 划分了 4 个独立的频段：2.4 GHz、3.6 GHz、4.9 GHz 和 5.8 GHz，每个频段又划分为若干信道。对于这些频段和信道的使用，各个国家制定的政策有所不同，内容包括最大发射功率、调制方式等。&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/1920px-2.4_GHz_Wi-Fi_channels_(802.11b,g_WLAN).svg.webp&quot; alt=&quot;WLAN 2.4 GHz 信道图&quot; /&gt;
  &lt;figcaption&gt;
      &lt;a href=&quot;https://zh.wikipedia.org/wiki/WLAN%E4%BF%A1%E9%81%93%E5%88%97%E8%A1%A8&quot;&gt;WLAN 2.4 GHz 信道&lt;/a&gt;

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;p&gt;WLAN 在 2.4 GHz 频段可以使用的具体频率是 2.412 GHz ~ 2.472 GHz（信道中心频率），总共是 80 MHz 的带宽，这个频段划分出 13 个相互重叠的信道，在 OFDM 调制中，每个信道的带宽是 20 MHz（DSSS调制是 22 MHz），换言之，2.4 GHz频段工作时只有三个互不干扰的信道，分别为 1、6、11。&lt;/p&gt;

&lt;p&gt;5 GHz 频段的频率是 4.915GHz ~ 5.825GHz，一共划分了 32 个信道，每个信道带宽有 10 MHz、20 MHz、40 MHz、80 MHz 和 160 MHz 不等，有 22 个互不干扰的信道。&lt;/p&gt;

&lt;h3 id=&quot;2-调制方式&quot;&gt;2. 调制方式&lt;/h3&gt;

&lt;p&gt;802.11 常用调制方式有 DSSS 和 OFDM。&lt;/p&gt;

&lt;p&gt;DSSS（直接序列展频）是利用 10 个以上的 chip 来表示原来的 0 和 1，使原本高频率、窄频的信号转换为低功率的宽频信号，完成扩频，接收方再以同样的规则解扩，从各 chip 中恢复原信号。&lt;/p&gt;

&lt;p&gt;OFDM（正交频分复用）将一整段频段分割成数个子载波，而且让每个子载波相互正交，使得他们在频谱上并不互相重叠，可以降低干扰，传输端将信号摆置在频域上，透过反傅里叶转换转换至时域，增加循环前缀后传送出去，接收端去除信号循环前缀，再将时域信号转换回频域，解出原信号。&lt;/p&gt;

&lt;h3 id=&quot;3-mimo&quot;&gt;3. MIMO&lt;/h3&gt;

&lt;p&gt;SISO 和 MIMO 是 WLAN 天线发送和接收信号的两种方式。SISO (Single Input Single Output) 即单输入单输出，顾名思义是通信时一根发射天线对应一根接收天线；MIMO (Multiple Input Multiple Output) 即多输入多输出，表示多根发射天线和多跟接收天线的通信；除此之外还有 SIMO 和 MISO 等。早期的 802.11 采用 SISO，传输速率较慢，MIMO 通过增加天线数量大幅提高传输速率。&lt;/p&gt;

&lt;p&gt;MIMO 传输如下图，假设有 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;m&lt;/code&gt; 根发射天线，&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;n&lt;/code&gt; 根接收天线，那么可以得到 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;m × n&lt;/code&gt; 的传输矩阵，即可以产生 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;m × n&lt;/code&gt; 个信道。理论上信道容量和天线数量成正比。&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/Structure-of-multiple-input-multiple-output-MIMO-systems-with-N-transmit-TX-and-L.webp&quot; alt=&quot;MIMO 示意图&quot; /&gt;
  &lt;figcaption&gt;
      MIMO 传输示意

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;p&gt;MIMO 工作时，发射端将高速率的数据流拆分为几个低速率的子数据流，这些子数据流在不同天线上以相同频段发射，接收端将同时来自多根天线的信号以一定方式复原为原数据流。发射端使用多根天线平行发射子数据流，这种方式被称为空分复用，可以成倍提高信道容量；同时接收端多根天线接收到相同的信号，这被称为空间分集，提升信道的可靠性。此外MIMO还有波束成形、预编码等技术，它们并不互斥，可以互相配合应用。&lt;/p&gt;

&lt;p&gt;802.11ac Wave 2 引入了 MU-MIMO，即多用户多输出多输入，与单用户不同的是，发射端可以同时与多个接收端通信，各接收端互不干扰。&lt;/p&gt;

&lt;h2 id=&quot;三wlan-网络的组织方式&quot;&gt;三、WLAN 网络的组织方式&lt;sup id=&quot;fnref:1:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/h2&gt;

&lt;h3 id=&quot;1-wlan-网络组成&quot;&gt;1. WLAN 网络组成&lt;/h3&gt;

&lt;p&gt;一个 WLAN 网络中，有工作站（STA）、接入点（AP）、基本服务集（BSS）、扩展服务集（ESS）、骨干网络等成员。如下图：&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/80211-ess.webp&quot; alt=&quot;ESS 示意图&quot; /&gt;
  &lt;figcaption&gt;
      WLAN 组网示意

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;p&gt;AP 是 WLAN 存在的基础，STA 通过与 AP 关联加入 WLAN。BSS 是 802.11 网络组网的基本单元，一个 BSS 对应于一个 AP，它的服务范围也就是 AP 的信号覆盖范围。一个 AP 的信号覆盖范围有限，802.11 允许将多个 BSS 串联为一个 ESS，隶属于同一个 ESS 的 STA 可以相互通信。ESS 中各 BSS 连接至同一个骨干网络，为了在 ESS 中实现跨 BSS 通信，相应的 AP 之间要能够在骨干网络中建立 OSI 第二层的连接，骨干网络通常是以太网。&lt;/p&gt;

&lt;p&gt;在安全方面，802.11i 提供了 WLAN 安全机制，使用 802.11i 所定义和改良的身份验证协议和机密性协议的网络，被称为 RSN（Robust Security Network），其中的连接则为RSNA（RSN Associations）。&lt;/p&gt;

&lt;h3 id=&quot;2-wlan-网络类型&quot;&gt;2. WLAN 网络类型&lt;/h3&gt;

&lt;p&gt;BSS 根据组网结构不同分为两类，一类是集中于 AP 的基础结构型网络（BSS），一种是无 AP 的独立型网络（IBSS）。&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/80211-bss-type.webp&quot; alt=&quot;BSS 类型图&quot; /&gt;
  &lt;figcaption&gt;
      独立型与基础结构型网络的基本服务集

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;p&gt;基础结构性网络（Infrastructure BSS）是有 AP 参与的无线网络。AP 是基础结构型网络的关键，它向外界周期性地广播 Beacon 帧，宣告网络的存在，STA 在连入基础结构型网络时，必须先与 AP 建立关联。AP 负责处理网络中所有通信，STA1 与 STA2 通信时，发往 STA2 的数据必须从 STA1 发至 AP，然后由 AP 转发至 STA2。基础结构型网络服务集被界定在 AP 的传输范围之内。&lt;/p&gt;

&lt;p&gt;独立型网络（Independent BSS，简称 IBSS）是没有 AP 参与的无线网络。在 IBSS 中，STA 之间可以直接通信。IBSS 由两个或更多的 STA 组成，服务集覆盖范围不固定，由各 STA 轮流广播 Beacon 帧来宣告网络的存在。&lt;/p&gt;

&lt;h3 id=&quot;3-wlan-网络的运作方式&quot;&gt;3. WLAN 网络的运作方式&lt;/h3&gt;

&lt;p&gt;与以太网相比，WLAN 为设备提供了可移动性，为了让网络能够正确追踪移动节点及帧传递，802.11 定义了 9 种服务，见下表，其中前 3 种用来传送数据，其余 6 种均属管理操作。&lt;/p&gt;

&lt;div class=&quot;table-wrapper&quot;&gt;
  &lt;table&gt;&lt;caption&gt;
        WLAN 服务

    &lt;/caption&gt;

  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;服务&lt;/th&gt;
      &lt;th&gt;用途&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;分布式&lt;/td&gt;
      &lt;td&gt;传递帧时，可使用此服务来决定目的地在网络上的地址&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;整合&lt;/td&gt;
      &lt;td&gt;用来将帧传递至无线网络以外的 IEEE 802 LAN&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;MSDU 传送&lt;/td&gt;
      &lt;td&gt;用来传递数据至接收端&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;关联&lt;/td&gt;
      &lt;td&gt;用来建立 AP（作为网关使用）于特定移动式工作站间的关联&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;重新关联&lt;/td&gt;
      &lt;td&gt;用来变更 AP（作为网关使用）于特定移动式工作站间的关联&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;取消关联&lt;/td&gt;
      &lt;td&gt;用来从网络移除无线工作站&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;身份验证&lt;/td&gt;
      &lt;td&gt;建立关联之前用来进行身份验证（利用 MAC 地址）&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;解除身份验证&lt;/td&gt;
      &lt;td&gt;用来终结一段身份验证关系，其副作用是终止当前关联&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;机密性&lt;/td&gt;
      &lt;td&gt;用来防止窃听&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;传输功率控制（TPC）&lt;/td&gt;
      &lt;td&gt;频谱管理，降低工作站传输功率以减少干扰&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;动态频率选择（DFS）&lt;/td&gt;
      &lt;td&gt;频谱管理，避免在 5 GHz 频段干扰雷达操作&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;/div&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Gast, M. S. 802.11® 无线网络权威指南[M]. 第 2 版. O’Reilly Taiwan 公司. 南京 - 东南大学出版社, 2007.12: 24-37 &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt; &lt;a href=&quot;#fnref:1:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;</content><author><name>Lnki</name></author><category term="技术" /><category term="网络" /><category term="WLAN" /><summary type="html">关于无线网络，我们常提到 WLAN、Wi-Fi、IEEE 802.11 a/b/g/n/ac 等名词，它们似乎都可以指无线网络，这里先了解它们的概念和区别：</summary></entry><entry><title type="html">计算机网络模型</title><link href="https://www.lnki.me/2018/09/network-model/" rel="alternate" type="text/html" title="计算机网络模型" /><published>2018-09-08T00:00:00+08:00</published><updated>2018-09-08T00:00:00+08:00</updated><id>https://www.lnki.me/2018/09/network-model</id><content type="html" xml:base="https://www.lnki.me/2018/09/network-model/">&lt;h2 id=&quot;一osi-七层模型&quot;&gt;一、OSI 七层模型&lt;/h2&gt;

&lt;p&gt;OSI（Open System Interconnection）模型是一种计算机网络标准框架，是一种全球各种计算平台和网络之间数据通信的完整解决方案。OSI 是理论上的网络标准，而实际上的工业标准是 TCP/IP 协议族，理解 OSI 有助于理解 TCP/IP。&lt;/p&gt;

&lt;p&gt;OSI 是一种分组网络模型，定义了七层网络模型，每层的功能相互独立，通过定义一些协议来描述处理过程，这样的好处是上层的修改不影响下层的结构。OSI分层模型的核心思想是封装，上层的数据包对于下层协议而言就是一个黑箱，下层协议只处理本层信息，不关心上层数据包的内容。在通信过程中，下层协议对于上层协议是透明的，下层协议通过封装、编码、加密等方式承载上层协议的数据包。&lt;/p&gt;

&lt;p&gt;发送时，信息从应用层开始向下逐层封装，最终物理层将信息转化成信号传播到介质中；接收时，首先物理层从介质传来的信号中获取信息，再向上逐层拆包，最终到达应用层。&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/osi-model.webp&quot; alt=&quot;OSI 网络模型封装过程示意图&quot; /&gt;
  &lt;figcaption&gt;
      OSI 模型结构及数据封装

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;h3 id=&quot;1-物理层&quot;&gt;1. 物理层&lt;/h3&gt;

&lt;p&gt;物理层的处理单元是 bit（比特），负责将信息编码成电流脉冲、电磁波等形式的信号并传播出去，同时从信号中解码信息生成原始 bit 码。它定义了 bit 和信号之间的转换方式，以及物理介质的光电、电气和机械特性。&lt;/p&gt;

&lt;h3 id=&quot;2-数据链路层&quot;&gt;2. 数据链路层&lt;/h3&gt;

&lt;p&gt;数据链路层的处理单元是帧（Frame），负责构建物理设备的逻辑链路，并将输入的数据转换为数据帧，同时负责检测和修正传输出现的错误。工作在该层的设备主要是交换机。&lt;/p&gt;

&lt;p&gt;该层又被划分为两个子层，分别为介质访问控制（MAC）子层和逻辑链路控制（LLC）子层。&lt;/p&gt;

&lt;p&gt;MAC 子层的主要功能包括数据帧的封装/卸装，帧的寻址和识别，帧的接收与发送，链路的管理，帧的差错控制等。MAC 子层的存在屏蔽了不同物理链路种类的差异性，解决了局域网共用信道出现冲突时的介质使用权分配。在传统局域网中，普遍使用的 MAC 标准是 IEEE 802.3，即通常所说的以太网（Ethernet），采用 CSMA/CD 的方式避免冲突；在无线网络中，MAC 标准为 IEEE 802.11。MAC 子层还采用多种方式提高传输效率，包括 TDM、FDM、WDM 和 CDMA。&lt;/p&gt;

&lt;p&gt;LLC 子层向上层提供服务，包括传输可靠性保障和控制、数据包的分段与重组、数据包的顺序传输等，IEEE 802.2 定义了它的功能和服务，它提供了访问各种介质的方法。LLC 负责识别网络层协议，然后对它们进行封装。LLC 报头告诉数据链路层当帧被接收到时，应当对数据包做何处理。&lt;/p&gt;

&lt;h3 id=&quot;3-网络层&quot;&gt;3. 网络层&lt;/h3&gt;

&lt;p&gt;网络层的处理单元是包（Packet），提供点到点的数据传输服务，该层协议描述了在设备之间如何传输数据，即描述了如何确定数据包从发送方到接收方的路径，它依据独一的地址信息来为数据包提供路由；与此同时负责流量和拥塞控制，以防止网络资源耗尽。工作在该层的设备有路由器、防火墙等。&lt;/p&gt;

&lt;p&gt;IP 是网络层的核心协议，负责将数据包从源地址发送到目的地址，它提供不可靠的传输服务，并由一些辅助协议提供拓展功能。ICMP 负责差错控制，IGMP 负责建立和维护组播成员关系，两者数据承载在 IP 数据包之上；ARP 负责根据 IP 地址解析当前网络的物理地址，RARP 则根据物理地址解析 IP 地址，两者数据直接承载在帧上。IP 实现了不同网络之间的通信，每个网络的边界称为网关，IP 还提供了子网划分和子网融合，提供灵活的网络管理功能。&lt;/p&gt;

&lt;p&gt;网络层另一重要功能是路由，常见的路由协议由 RIP、OSPF 等等，这些协议负责建立和维护路由表，在转发 IP 数据包时，将目的地址和路由表逐条比对，然后从匹配的端口转发。&lt;/p&gt;

&lt;h3 id=&quot;4-传输层&quot;&gt;4. 传输层&lt;/h3&gt;

&lt;p&gt;传输层的处理单元是消息（Message），负责管理网络中端到端的消息传输，通过错误恢复和流量控制的机制为数据包传输提供可靠性和顺序性，同时提供了一种面向连接的数据包传输方式。&lt;/p&gt;

&lt;p&gt;传输层最主要的两个协议是 TCP 和 UDP，提供端口到端口、进程到进程的数据传输服务。TCP 是面向连接的，提供的是可靠服务，因此没有广播功能，它通过三次握手、ACK 应答、重传等机制进行差错控制，以及通过慢启动、快速重传、滑动窗口等机制进行流量控制；UDP 提供不可靠服务，能进行广播和组播，它没有差错控制和流量控制机制，数据包结构简单，封装快速，适用于需要快速响应或流量较大的应用。&lt;/p&gt;

&lt;h3 id=&quot;5-会话层&quot;&gt;5. 会话层&lt;/h3&gt;

&lt;p&gt;会话层使不同设备上的用户之间能够建立会话，它负责控制用户间逻辑链路的建立和终止，同时负责报告上层的错误。常见的协议有 SSL/TLS 和 RPC 等。&lt;/p&gt;

&lt;h3 id=&quot;6-表示层&quot;&gt;6. 表示层&lt;/h3&gt;

&lt;p&gt;表示层标记不同系统之间的数据差异，并指定独立于系统架构的数据传输格式，它负责编码解码、加密解密和压缩解压数据。&lt;/p&gt;

&lt;h3 id=&quot;7-应用层&quot;&gt;7. 应用层&lt;/h3&gt;

&lt;p&gt;应用层包含用户使用的各种服务和协议，例如文件传输、电子邮件、Web 等等。&lt;/p&gt;

&lt;h2 id=&quot;二tcpip-四层模型&quot;&gt;二、TCP/IP 四层模型&lt;/h2&gt;

&lt;p&gt;尽管 OSI 定义很完善，但存在一些问题，首先实现复杂度较高，其次各层的功能划分不均，例如表示层和会话层的功能相对较少，因此相对简单的 TCP/IP 协议族是实际上的工业标准。TCP/IP 层级模型类似 OSI，但是没有公认的标准，通常采用四层模型来描述，相比于 OSI，TCP/IP 四层模型取消了会话层和表示层，同时把物理层和数据链路层融合为一个网络接口层。&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/osi-tcp-ip.webp&quot; alt=&quot;TCP/IP 模型图&quot; /&gt;
  &lt;figcaption&gt;
      OSI 与 TCP/IP 模型

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;h3 id=&quot;1-网络接口层&quot;&gt;1. 网络接口层&lt;/h3&gt;

&lt;p&gt;网络接口层规定主机必须使用某种协议连接到网络，以便向该主机发送 IP 数据包；这里所提到的协议并没有明确定义，可能在不同主机和网络上有不同的定义和实现。&lt;/p&gt;

&lt;h3 id=&quot;2-网络层&quot;&gt;2. 网络层&lt;/h3&gt;

&lt;p&gt;这里的网络层功能上和 OSI 网络层类似，它定义了正式的 IP 协议，规定了网络间传输的数据包格式和协议，IP 是 TCP/IP 协议族中最重要的协议，主要功能是将数据包发送到指定的目的地。&lt;/p&gt;

&lt;h3 id=&quot;3-传输层&quot;&gt;3. 传输层&lt;/h3&gt;

&lt;p&gt;传输层同样功能上类似于OSI传输层，主要包含两个端到端协议：TCP 和 UDP，它们也是 TCP/IP 中的重要协议，用于不同系统之间的跨进程通信。&lt;/p&gt;

&lt;h3 id=&quot;4-应用层&quot;&gt;4. 应用层&lt;/h3&gt;

&lt;p&gt;与OSI不同的是，应用层之下不再包括表示层和会话层，功能上和OSI应用层相似，提供高层的协议，例如 SMTP、FTP 等等。&lt;/p&gt;

&lt;h2 id=&quot;三五层模型&quot;&gt;三、五层模型&lt;/h2&gt;

&lt;p&gt;上述的 TCP/IP 模型没有很好地描述物理层和数据链路层的功能，而 OSI 模型的会话层和表示层几乎闲置，综合两者的特点，提出一种五层模型来描述网络分层结构，它类似于 TCP/IP 四层模型，只是将网络接口层替换为 OSI 七层模型的物理层和数据链路层，包括物理层、数据链路层、网络层、传输层和应用层。&lt;/p&gt;

&lt;p&gt;五层模型仅用于学习和理解计算机网络原理，实际网络工程中并不常见。&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/osi-5-leyer-arch.webp&quot; alt=&quot;五层模型图&quot; /&gt;
  &lt;figcaption&gt;
      五层模型与 OSI

    &lt;/figcaption&gt;&lt;/figure&gt;</content><author><name>Lnki</name></author><category term="技术" /><category term="网络" /><summary type="html">一、OSI 七层模型</summary></entry><entry><title type="html">Android 系统架构</title><link href="https://www.lnki.me/2018/09/android-arch/" rel="alternate" type="text/html" title="Android 系统架构" /><published>2018-09-05T00:00:00+08:00</published><updated>2018-09-05T00:00:00+08:00</updated><id>https://www.lnki.me/2018/09/android-arch</id><content type="html" xml:base="https://www.lnki.me/2018/09/android-arch/">&lt;p class=&quot;notice&quot;&gt;本文所述 Android 架构，是指 Android 系统内部的体系&lt;a href=&quot;https://source.android.com/devices/architecture&quot; title=&quot;Android 架构&quot;&gt;架构&lt;/a&gt;，相对于应用开发角度的 Android &lt;a href=&quot;https://developer.android.com/guide/platform&quot; title=&quot;平台架构&quot;&gt;平台架构&lt;/a&gt;，更偏重展现 Android 系统内部的调用机制，用于指导 Android 硬件开发和系统开发。&lt;/p&gt;

&lt;h2 id=&quot;一架构&quot;&gt;一、架构&lt;/h2&gt;

&lt;p&gt;先看看来自官方的架构图：&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/ape_fwk_all.webp&quot; alt=&quot;Android 架构图&quot; /&gt;
  &lt;figcaption&gt;
      Android 架构

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;p&gt;可以看到，Android 系统分为五层，自上而下依次为：&lt;/p&gt;

&lt;h3 id=&quot;1-应用框架层&quot;&gt;1. 应用框架层&lt;/h3&gt;

&lt;p&gt;应用框架层中的 API 主要用于应用开发，而从系统开发角度，这些 API 都是底层 HAL 接口的映射，可以理解为 Android 系统和应用之间的边界。&lt;/p&gt;

&lt;h3 id=&quot;2-binder-ipc-层&quot;&gt;2. Binder IPC 层&lt;/h3&gt;

&lt;p&gt;Binder Inter-Process Communication（IPC），基于 Binder 的进程间通信机制，允许应用框架层跨越进程边界并调用 Android 系统服务层代码，实现框架 API 与 Android 系统服务之间的交互。这些通信过程对于应用开发者是透明的。&lt;/p&gt;

&lt;h3 id=&quot;3-系统服务层&quot;&gt;3. 系统服务层&lt;/h3&gt;

&lt;p&gt;系统服务是负责不同功能的模块化组件，例如窗口管理器、通知管理器、WLAN 管理器等等，应用框架 API 通过与系统服务通信来访问系统功能和底层硬件。Android 包含两组服务：“系统”（比如窗口管理器、通知管理器等服务）和“媒体”（与播放、录制媒体相关的服务）。&lt;/p&gt;

&lt;h3 id=&quot;4-硬件抽象层hal&quot;&gt;4. 硬件抽象层（HAL）&lt;/h3&gt;

&lt;p&gt;Hardware Abstraction Layer（HAL），硬件抽象层，定义标准接口供硬件开发者实现，硬件开发者可以通过这些接口方便地实现特定功能，而不用担心对系统上层造成影响，系统服务则可以通过访问硬件抽象层，忽略更低级别的驱动实现。除了标准接口，Android 也允许系统开发者自定义 HAL 接口，便于实现定制功能。HAL 的实现会被封装成模块，通常编译为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.so&lt;/code&gt; 文件，并由 Android 系统适时加载。&lt;/p&gt;

&lt;p&gt;从 Android 8.0 开始，引入了 HIDL，HAL 的运行方式也分为了两种：绑定式和直通式，Android 框架和系统服务通过 Binder IPC 机制与绑定式 HAL 通信，直通式则是在系统服务的同一进程下直接调用 HAL。绝大多数 HAL 是绑定式。&lt;/p&gt;

&lt;h3 id=&quot;5-linux-内核层&quot;&gt;5. Linux 内核层&lt;/h3&gt;

&lt;p&gt;开发设备驱动程序类似于开发典型的 Linux 设备驱动程序。除了驱动程序，Android 使用的 Linux 内核还包含一些特殊的补充功能，例如低内存终止、唤醒锁定、Binder IPC 驱动等等，以及对移动嵌入式平台来说非常重要的其他功能，如 wpa_supplicant、netd 等等。这些补充功能主要用于增强系统功能，不会影响驱动程序开发。&lt;/p&gt;

&lt;h2 id=&quot;二运行机制&quot;&gt;二、运行机制&lt;/h2&gt;

&lt;p&gt;上面静态地展示了 Android 的系统架构，只是抽象地了解了其大体结构和所扮演的角色。为更具体地理解 Android 运行机制，下面以 &lt;a href=&quot;https://source.android.com/devices/audio&quot;&gt;Audio 模块&lt;/a&gt;为例，动态地看一看 Android 运行时的调用过程：&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  
  &lt;img src=&quot;/contents/posts/ape_fwk_audio.webp&quot; alt=&quot;Android Audio 架构图&quot; /&gt;
  &lt;figcaption&gt;
      Android Audio 架构

    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;p&gt;当某个应用访问 Audio 模块时，自上而下的调用过程如下：&lt;/p&gt;

&lt;h3 id=&quot;1-应用框架&quot;&gt;1. 应用框架&lt;/h3&gt;

&lt;p&gt;应用框架包含应用的代码，该代码可使用 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;android.media&lt;/code&gt; API 与 Audio 硬件进行交互。在内部，此代码会调用相应的 JNI 粘合类，以访问与 Audio 硬件交互的 native 代码。应用可以直接调用的框架代码位于 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;frameworks/base/media/java&lt;/code&gt;。&lt;/p&gt;

&lt;h3 id=&quot;2-jni&quot;&gt;2. JNI&lt;/h3&gt;

&lt;p&gt;与 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;android.media&lt;/code&gt; 关联的 JNI 代码可调用较低级别的原生代码，以访问 Audio 硬件。JNI 代码位于 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;frameworks/base/core/jni&lt;/code&gt; 和 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;frameworks/base/media/jni&lt;/code&gt;。&lt;/p&gt;

&lt;h3 id=&quot;3-native-框架&quot;&gt;3. Native 框架&lt;/h3&gt;

&lt;p&gt;Native 框架提供相当于 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;android.media&lt;/code&gt; 包的 native 代码包，调用 Binder IPC 代理以访问 Media 服务器的特定于音频的服务。原生框架代码位于 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;frameworks/av/media/libmedia&lt;/code&gt;。&lt;/p&gt;

&lt;h3 id=&quot;4-binder-ipc&quot;&gt;4. Binder IPC&lt;/h3&gt;

&lt;p&gt;Binder IPC 代理用于促进跨越进程边界的通信。代理代码位于 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;frameworks/av/media/libmedia&lt;/code&gt;，文件以字母“I”开头。&lt;/p&gt;

&lt;h3 id=&quot;5-media-服务&quot;&gt;5. Media 服务&lt;/h3&gt;

&lt;p&gt;Media 服务包含 Audio 服务，这些 Audio 服务是实际与 HAL 实现进行交互的代码。Media 服务位于 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;frameworks/av/services/audioflinger&lt;/code&gt;。&lt;/p&gt;

&lt;h3 id=&quot;6-hal&quot;&gt;6. HAL&lt;/h3&gt;

&lt;p&gt;HAL 定义了由 Audio 服务调用的标准接口，必须正确实现这些接口以确保 Audio 硬件功能正常运行。Audio HAL 接口位于 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hardware/libhardware/include/hardware&lt;/code&gt;。&lt;/p&gt;

&lt;h3 id=&quot;7-内核驱动程序&quot;&gt;7. 内核驱动程序&lt;/h3&gt;

&lt;p&gt;Audio 驱动程序分别与硬件和 HAL 实现进行交互，最终完成从应用对 Audio 硬件的访问。可以使用高级 Linux 音频架构（ALSA）、开放声音系统（OSS）或自定义驱动程序（HAL 与驱动程序无关）。&lt;/p&gt;

&lt;h2 id=&quot;三总结&quot;&gt;三、总结&lt;/h2&gt;

&lt;p&gt;经过对 Android 系统内部架构的梳理，可以看到，这种架构就类似于网络中常见的 C/S 架构，系统服务是服务器，应用程序是客户端，Binder IPC 机制则是承载两者交互的网络，Android 把每个系统功能拆分成不同的系统服务，它们管理相应的系统资源，通过 Binder IPC 机制，使每个应用有条不紊地向系统服务请求资源。&lt;/p&gt;</content><author><name>Lnki</name></author><category term="技术" /><category term="Android" /><summary type="html">本文所述 Android 架构，是指 Android 系统内部的体系架构，相对于应用开发角度的 Android 平台架构，更偏重展现 Android 系统内部的调用机制，用于指导 Android 硬件开发和系统开发。</summary></entry></feed>